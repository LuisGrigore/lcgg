CC ?= gcc
CFLAGS ?= -Wall -Wextra -O2
REPLACEMENT = -I

TEST_DIR ?= test
SRC_DIR ?= src
EXTERNALS_DIR ?= externals/Unity-master/src

TEST_C_FILES = $(shell find $(TEST_DIR) -name "*.c")
TEST_H_DIRS = $(shell find $(TEST_DIR) -type d)

SRC_C_FILES = $(shell find $(SRC_DIR) -name "*.c")
SRC_H_DIRS = $(shell find $(SRC_DIR) -type d)


EXTERNAL_C_FILES = $(shell find $(EXTERNALS_DIR) -name "*.c")
EXTERNAL_H_DIRS = $(shell find $(EXTERNALS_DIR) -type d)

MODIFIED_VAR = $(word 1, $(SRC_H_DIRS))$(foreach w,$(wordlist 2,$(words $(SRC_H_DIRS)), $(SRC_H_DIRS)), $(REPLACEMENT)$(w))

# Reemplaza la extensi√≥n .c por .o para generar los archivos objeto
TEST_OBJ_FILES := $(TEST_C_FILES:.c=.o)

# Regla para compilar cada archivo fuente por separado
test_obj_files: $(TEST_C_FILES)
	@echo
	@echo $(MODIFIED_VAR)
	@echo
	$(CC) $(CFLAGS) $(TEST_C_FILES) -I$(EXTERNAL_H_DIRS) $(MODIFIED_VAR) -o


all: $(test_obj_files)


clean:
	rm -f $(SRC_DIR)/* $(SRC_DIR)/*/$(EXES)

.PHONY: all clean
