CC := gcc
CFLAGS := -Wall -Wextra -Werror -Iexternals -MMD -MP
LDFLAGS := -Lexternals
LDLIBS := -lm  # Add necessary libraries here

TEST_DIR ?= test
BUILD_DIR ?= target/build
EXT_DEPS ?= externals

# Find all .c files in the test directory and subdirectories
#SRC_FILES := $(shell find $(TEST_DIR) -name "*.c")
EXEC_FILES := $(SRC_FILES:.c=)
OBJ_FILES := $(shell find $(BUILD_DIR) -name "*.o")
DEP_FILES := $(shell find $(BUILD_DIR) -name "*.d")

all: $(EXEC_FILES)

	@echo $(SRC_FILES)
	@echo
	@echo $(EXEC_FILES)
	@echo
	@echo $(OBJ_FILES)
	@echo
	@echo $(DEP_FILES)
	@echo

$(TEST_DIR)/%: $(TEST_DIR)/%.c $(OBJ_FILES) $(DEP_FILES)
	$(CC) $(CFLAGS) $< $(OBJ_FILES) $(LDFLAGS) $(LDLIBS) -o $@

# Include dependency files
-include $(DEP_FILES)

clean:
	rm -rf $(EXEC_FILES)

.PHONY: all clean
