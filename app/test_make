# Configuraci√≥n de directorios
SRC_DIR ?= src            # Directorio de origen con archivos .c y .h
EXTERNALS_DIR ?= externals # Directorio que contiene archivos de encabezado externos
SOURCE_DIR ?= AA

# Buscar todos los archivos .c en el directorio de origen y subdirectorios
SRCS = $(shell find $(SRC_DIR) $(SOURCE_DIR) -name "*.c")

# Generar la lista de archivos ejecutables correspondientes
EXES = $(patsubst $(SRC_DIR)/%.c,$(SRC_DIR)/%,$(SRCS))

# Buscar todos los subdirectorios de SRC_DIR y almacenarlos en la variable INC_DIRS
INC_DIRS = $(shell find $(SOURCE_DIR) $(SRC_DIR) $(EXTERNALS_DIR) -type d)

# Regla principal: compilar todos los ejecutables
all: $(EXES)

# Regla para compilar archivos .c a ejecutables
$(SRC_DIR)/%: $(SRC_DIR)/%.c
	@mkdir -p $(dir $@)      # Crear el directorio de destino si no existe
	gcc -o $@ $< $(addprefix -I,$(INC_DIRS))  # Compilar el archivo .c en ejecutable

# Regla para limpiar los ejecutables generados
clean:
	rm -f $(SRC_DIR)/* $(SRC_DIR)/*/$(EXES)

.PHONY: all clean
